<html>
<script src='https://d3js.org/d3.v5.min.js'></script>
<style> circle {
    fill: lightblue;
    stroke: black;
}
.label { font: 12px sans-serif; }
.tooltip {
    position: absolute;
    width: 200px;
    height: 28px;
    pointer-events: none;
    font: 6px sans-serif;
}

a {
    text-decoration: none;
    display: inline-block;
    padding: 8px 16px;
}

a:hover {
    background-color: #ddd;
    color: black;
}

.previous {
    background-color: #f1f1f1;
    color: black;
}

.next {
    background-color: #4CAF50;
    color: white;
}

.round {
    border-radius: 50%;
}
</style>
<body onload='init()'>
<p> Here, you can explore the top 10 per capita CO2 emission changes for every decade from 1970-2010 by choosing the Select Year option  </p>
<svg width=500 height=500>
</svg>
<div class="row align-items-center">
    <div class="col-sm-2"><p id="value-time"></p></div>
    <div class="col-sm"><div id="slider-time"></div></div>
<a href="/dataviz/page2.html" class="previous round">&#8249;</a>
<a href="/dataviz/page2.html" class="previous">&laquo; Previous</a>
<script>
    async function init() {
        var width = 400;
        var height = 400;
        xdomain = [2000, 20000000];
        ydomain = [0, 70];
        rdomain = [0, 200000000]

        // add the tooltip area to the webpage
        var tooltip = d3.select("body").append("div")
            .attr("class", "tooltip")
            .style("opacity", 0);

        d3.csv("/dataviz/CO2_AllDecades_Top10_new.csv").then(function (data) {
//            var yScale = d3.scaleLog().base(10).domain([0, 2000000]).range([height, 0]);
            var yScale = d3.scaleLinear().domain(ydomain).range([height, 0]).nice();

            var yAxis = d3.axisLeft(yScale);
            var yValue = function(d) { return d.Emissionspercapita;}

            var countryvalue = function(d){ return d.CountryName;}

//            var xScale = d3.scaleLog().base(10).domain([0, 2000000]).range([0, width]);
//            var xScale = d3.scaleLinear().domain(xdomain).range([0, width]).nice();
//            var xAxis = d3.axisBottom(xScale).tickFormat(d => d/1000);
            var xScale = d3.scaleLog().base(10).domain(xdomain).range([0, width]).nice();
            var xAxis = d3.axisBottom(xScale).tickValues([100,1000,10000,100000,1000000, 10000000]).tickFormat(d3.format("~s"));
            var xValue = function(d) { return d.EmissionsTotal;}
            var rScale = d3.scaleSqrt().domain(rdomain).range([0, 10]);

            var chart = d3.select("svg")
                .append("g")
                .attr("transform", "translate(50,50)");

            chart.selectAll("circle")
                .data(data)
                .enter()
                .append("circle")
                .filter(function(data) {
                    return (data.Year == '2010');
                })
                .attr("cx", function (data) {
                    return (xScale(+data.EmissionsTotal));
                })
                .attr("cy", function (data) {
                    return (yScale(+data.Emissionspercapita));
                })
                .attr("r", function (data) {
                    return (5);
                })
                .on("mouseover", function(d) {
                    tooltip.transition()
                        .duration(200)
                        .style("opacity", .9);
                    tooltip.html(countryvalue(d)+ "<br/> Total Emissions: " +  xValue(d)
                        + "<br/> Emissions Per Capita: " + yValue(d) )
                        .style("left", (d3.event.pageX + 5) + "px")
                        .style("top", (d3.event.pageY - 28) + "px");
                })
                .on("mouseout", function(d) {
                    tooltip.transition()
                        .duration(500)
                        .style("opacity", 0);
                });

            svg = d3.select("svg");

            svg.append("g")
                .attr("transform", "translate(50,50)")
                .call(yAxis);

                d3.select("svg").append("text")
                .attr("class", "label")
                .attr("transform", "rotate(-90)")
                .attr("y", 17)
                    .attr("x",-80)
                .attr("dy", ".71em")
                .style("text-anchor", "end")
                .text("Emissions(per capita) in  Metric tonnes");


            d3.select("svg")
                .append("g")
                .attr("transform", "translate(50,450)")
                .call(xAxis);

            d3.select("svg")
                .append("text")
                .attr("class", "label")
                .attr("x", width)
                .attr("y", 480)
                .style("text-anchor", "end")
                .text("EEmissions(Total) in Metric Tonnes - Logarithmic Scale")
            ;

            var dataTime = d3.range(0, 10).map(function(d) {
                return new Date(1995 + d, 10, 3);
            });

// Create a select element
            var select = d3.select("body")
                .append("select")
                .on("change", function() {
                    // Log value it is changed to:
                    selval = this.value;
                    chart.remove();
                        chart = d3.select("svg")
                        .append("g")
                        .attr("transform", "translate(50,50)");
                    chart.selectAll("circle")
                        .data(data)
                        .enter()
                        .append("circle")
                        .filter(function(data) {
                            return data.Year == selval;
                        })
                        .attr("cx", function (data) {
                            return (xScale(+data.EmissionsTotal));
                        })
                        .attr("cy", function (data) {
                            return (yScale(+data.Emissionspercapita));
                        })
                        .attr("r", function (data) {
                            return (5);
                        })
                        .on("mouseover", function(d) {
                            tooltip.transition()
                                .duration(200)
                                .style("opacity", .9);
                            tooltip.html(countryvalue(d)+ "<br/> Total Emissions: " +  xValue(d)
                                + "<br/> Emissions Per Capita: " + yValue(d) )
                                .style("left", (d3.event.pageX + 5) + "px")
                                .style("top", (d3.event.pageY - 28) + "px");
                        })
                        .on("mouseout", function(d) {
                            tooltip.transition()
                                .duration(500)
                                .style("opacity", 0);
                        });

                })

// Add an initial option:
            select.append("option")
                .html("Select Year:")

// Add the columns as options:
            /*            var options = select.selectAll(null)
                            .data(data)
                            .enter()
                            .append("option")
                            .text(function(d) { return d.Year; });*/
            var values = d3.keys(data.Year)


            // Add the columns as options:
            var options = select.selectAll(null)
                .data(d3.map(data, function(d){return d.Year;}).keys())
                .enter()
                .append("option")
                .text(function(d) {
                    return d; });

        }).catch(function (error) {

            console.log("error");
        });

    }

</script>
</body>
</html>

